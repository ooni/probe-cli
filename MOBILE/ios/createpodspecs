#!/bin/bash
set -euo pipefail
__version=$(date -u +%Y.%m.%d-%H%M%S)
__release=$(git describe --tags || echo '0.0.0-dev')

# determine whether we're publishing to a release or to rolling
#
# when publishing to rolling the __release variable is like: 'v3.19.0-alpha-27-g4678578b'
if ! [[ $__release =~ ^v[0-9]+\.[0-9]+\.[0-9]+(-[a-z]+)$ ]]; then
	__release=rolling
fi

for name in libcrypto libevent libssl libtor libz oonimkall; do
	cat ./MOBILE/ios/${name}-template.podspec | sed -e "s/@VERSION@/$__version/g" \
		-e "s/@RELEASE@/$__release/g" >./MOBILE/ios/${name}.podspec
done
